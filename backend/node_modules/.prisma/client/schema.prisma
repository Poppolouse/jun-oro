generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String            @id @default(cuid())
  name            String
  email           String?           @unique
  username        String?           @unique
  createdAt       DateTime          @default(now())
  lastActive      DateTime          @default(now())
  role            String            @default("user")
  updatedAt       DateTime          @default(now()) @updatedAt
  password        String?
  profileImage    String?
  profileImageKey String?
  status          String            @default("pending")
  adminAuditLogs  AdminAuditLog[]
  apiKeys         ApiKey[]
  changelogs      Changelog[]
  cycles          Cycle[]
  sessions        GameSession[]
  libraryEntries  LibraryEntry[]
  notifications   Notification[]
  pageVisits      PageVisit[]
  session_history session_history[]
  user_libraries  user_libraries?
  preferences     UserPreferences?
  userStats       UserStats?

  @@map("users")
}

model ApiKey {
  id          String    @id @default(cuid())
  userId      String?
  serviceName String
  keyName     String
  keyValue    String
  isActive    Boolean   @default(true)
  isGlobal    Boolean   @default(false)
  metadata    Json?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  lastUsed    DateTime?
  user        User?     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([serviceName, userId])
  @@map("api_keys")
}

model Game {
  id               String            @id
  name             String
  cover            String?
  firstReleaseDate DateTime?
  genres           Json?
  platforms        Json?
  summary          String?
  rating           Float?
  developer        String?
  developers       Json?
  publisher        String?
  publishers       Json?
  steamData        Json?
  igdbData         Json?
  hltbData         Json?
  metacriticData   Json?
  cachedAt         DateTime          @default(now())
  lastAccessed     DateTime          @default(now())
  accessCount      Int               @default(1)
  coverKey         String?
  campaigns        Campaign[]
  sessions         GameSession[]
  libraryEntries   LibraryEntry[]
  session_history  session_history[]

  @@map("games")
}

model LibraryEntry {
  id         String    @id @default(cuid())
  gameId     String
  category   String    @default("wishlist")
  playtime   Int       @default(0)
  rating     Float?
  notes      String?
  lastPlayed DateTime?
  status     String    @default("backlog")
  addedAt    DateTime  @default(now())
  isPublic   Boolean   @default(false)
  tags       Json?
  updatedAt  DateTime  @default(now()) @updatedAt
  userId     String
  priority   Int       @default(3)
  game       Game      @relation(fields: [gameId], references: [id])
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, gameId])
  @@map("library_entries")
}

model UserPreferences {
  id                    String  @id @default(cuid())
  userId                String  @unique
  preferredPlatform     String?
  preferredStatus       String  @default("Oynamak Ä°stiyorum")
  includeDLCs           Boolean @default(false)
  selectedDLCs          Json?
  selectedCampaigns     Json?
  preferredVersion      String?
  gameSpecificPrefs     Json?
  autoLoadHLTB          Boolean @default(true)
  autoLoadMetacritic    Boolean @default(true)
  autoGenerateCampaigns Boolean @default(true)
  user                  User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

model GameSession {
  id        String    @id @default(cuid())
  userId    String
  gameId    String
  gameName  String
  startTime DateTime  @default(now())
  endTime   DateTime?
  playtime  Int       @default(0)
  isActive  Boolean   @default(true)
  campaigns Json?
  platform  String?
  status    String?
  game      Game      @relation(fields: [gameId], references: [id])
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("game_sessions")
}

model UserStats {
  id             String    @id @default(cuid())
  userId         String    @unique
  totalPlayTime  Int       @default(0)
  totalSessions  Int       @default(0)
  gamesPlayed    Int       @default(0)
  gamesCompleted Int       @default(0)
  lastPlayedGame String?
  lastPlayedAt   DateTime?
  weeklyStats    Json?
  monthlyStats   Json?
  achievements   Json?
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_stats")
}

model Campaign {
  id               String     @id @default(cuid())
  gameId           String
  name             String
  description      String?
  averageDuration  String?
  customProperties Json?
  parentId         String?
  isAutoGenerated  Boolean    @default(false)
  isMainCampaign   Boolean    @default(false)
  difficulty       String?
  features         Json?
  createdAt        DateTime   @default(now())
  game             Game       @relation(fields: [gameId], references: [id], onDelete: Cascade)
  parent           Campaign?  @relation("CampaignHierarchy", fields: [parentId], references: [id])
  children         Campaign[] @relation("CampaignHierarchy")

  @@map("campaigns")
}

model PageVisit {
  id        String   @id @default(cuid())
  userId    String
  page      String
  visitedAt DateTime @default(now())
  metadata  Json?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("page_visits")
}

model Notification {
  id        String    @id @default(cuid())
  userId    String?
  title     String
  message   String
  type      String    @default("info")
  isRead    Boolean   @default(false)
  isGlobal  Boolean   @default(false)
  metadata  Json?
  createdAt DateTime  @default(now())
  expiresAt DateTime?
  user      User?     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model SystemUpdate {
  id          String             @id @default(cuid())
  title       String
  description String
  version     String?
  type        String             @default("feature")
  status      String             @default("planned")
  progress    Int                @default(0)
  priority    String             @default("medium")
  category    String?
  metadata    Json?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  completedAt DateTime?
  substeps    SystemUpdateStep[]

  @@map("system_updates")
}

model SystemUpdateStep {
  id          String       @id @default(cuid())
  updateId    String
  title       String
  description String?
  progress    Int          @default(0)
  status      String       @default("pending")
  order       Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  completedAt DateTime?
  update      SystemUpdate @relation(fields: [updateId], references: [id], onDelete: Cascade)

  @@map("system_update_steps")
}

model Platform {
  id        String   @id @default(cuid())
  name      String   @unique
  logoUrl   String?
  logoKey   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("platforms")
}

model Changelog {
  id          String    @id @default(cuid())
  title       String
  content     String
  version     String?
  type        String    @default("update")
  isPublished Boolean   @default(true)
  publishedAt DateTime? @default(now())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  authorId    String
  releaseDate DateTime?
  author      User      @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@map("changelogs")
}

model AdminAuditLog {
  id           String   @id @default(cuid())
  action       String
  targetType   String
  targetId     String?
  targetName   String?
  details      Json?
  ipAddress    String?
  userAgent    String?
  success      Boolean  @default(true)
  errorMessage String?
  createdAt    DateTime @default(now())
  adminId      String
  admin        User     @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@map("admin_audit_logs")
}

model session_history {
  id        String   @id
  userId    String
  gameId    String
  gameName  String
  startTime DateTime
  endTime   DateTime
  playtime  Int
  campaigns Json?
  platform  String?
  status    String?
  createdAt DateTime @default(now())
  games     Game     @relation(fields: [gameId], references: [id])
  users     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_libraries {
  id            String   @id
  userId        String   @unique
  version       String   @default("1.0")
  totalGames    Int      @default(0)
  totalPlaytime Int      @default(0)
  lastUpdated   DateTime @default(now())
  users         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Cycle {
  id          String    @id @default(cuid())
  userId      String
  name        String
  description String?
  gameIds     Json      @default("[]")
  status      String    @default("planned")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt
  startedAt   DateTime?
  completedAt DateTime?
  order       Int       @default(0)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("cycles")
}
